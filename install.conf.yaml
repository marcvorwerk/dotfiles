- defaults:
    link:
      relink: true
      create: true
      force: false # maybe change to true?
    shell:
      quiet: true
      stdout: true

- clean: ['~']

- shell:
  - [git submodule update --recursive --init, Installing submodules]

- create:
    - ~/.config/htop
    - ~/.config/cheat/cheatsheets

- shell:
    - description: Install Cheat
      command: scripts/install_cheat.sh --version 4.4.2
      stdin: false
      stdout: true
      stderr: true

- link:
    ~/.zshrc: zsh/zshrc
    ~/.env.zsh: zsh/env.zsh
    ~/.aliases.zsh: zsh/aliases.zsh
    ~/.functions.zsh: zsh/functions.zsh
    ~/.p10k.zsh: zsh/p10k.zsh
    ~/.fzf.zsh: autocompetions/fzf.zsh
    ~/.config/htop/htoprc: confs/htoprc
    ~/.config/cheat/conf.yml: confs/cheat.yml
    ~/.config/cheat/cheat.zsh: autocompetions/cheat.zsh
    # ~/.config/cheat/cheat.zsh:
    ~/.config/cheat/cheatsheets/personal/: cheats/
    ~/.profile: confs/profile
    ~/.inputrc: confs/inputrc
    ~/.config/nvim/: nvim/
    ~/.config/nvim.vscode: vscode/nvim.vscode
    ~/.config/kitty/: kitty/
    ~/.config/wezterm/: wezterm/
    ~/.config/stew/: stew/
    ~/.gitconfig: git/gitconfig

- git: 
    ~/.oh-my-zsh:
        url: git@github.com:ohmyzsh/ohmyzsh.git
        branch: master
        method: clone-or-pull
    ~/.oh-my-zsh/custom/plugins/zsh-syntax-highlighting:
        url: git@github.com:zsh-users/zsh-syntax-highlighting.git
        branch: master
        method: clone-or-pull
    ~/.oh-my-zsh/custom/themes/powerlevel10k:
        url: git@github.com:romkatv/powerlevel10k.git
        branch: master
        method: clone-or-pull
    ~/.pyenv:
        url: git@github.com:pyenv/pyenv.git
        branch: master
        method: clone-or-pull
    ~/.pyenv/plugins/pyenv-virtualenv:
        url: git@github.com:pyenv/pyenv-virtualenv.git
        branch: master
        method: clone-or-pull
    ~/.pyenv/plugins/pyenv-update:
        url: git@github.com:pyenv/pyenv-update.git
        branch: master
        method: clone-or-pull
    ~/.pyenv/plugins/pyenv-doctor:
        url: git@github.com:pyenv/pyenv-doctor.git
        branch: master
        method: clone-or-pull
#    ~/GIT/github.com/fzf:
#        url: git@github.com:junegunn/fzf.git
#        branch: master
#        method: clone

#- pip:
#    file: requirements.txt
#    binary: /home/marc/.pyenv/shims/pip
#    user: true    # Like --user
#    stdout: false # Print the execution stdout
#    stderr: true  # Print the execution stderr

- if:
  - cond: 'grep -Eqi "(^ID=ubuntu|^ID=debian|ID_LIKE=.*debian)" /etc/os-release'
    met:

    - sudo:
        - link:
            /etc/apt/sources.list.d/:
                glob: true
                path: apt.sources.lists/*

    - apt:
      - bat
      - bind9-dnsutils
      - btop
      - direnv
      - eza
      - fd-find
      - fonts-hack
      - git
      - git-extras
      - git-review
      - htop
      - ipcalc
      - iperf3
      - jq
      - python3-pygments
      - neovim
      - nnn
      - nmap
      - ripgrep
      - tilix
      - tldr
      - tree
      - wl-clipboard
      - wezterm
      - wireguard
      - code
      - unrar
      - zsh

- if:
  - cond: 'grep -Eqi "(^ID=fedora|ID_LIKE=.*fedora|ID_LIKE=.*rhel)" /etc/os-release'
    met:

    - dnf:
      - bat
      - bind-utils
      - btop
      - direnv
      - https://github.com/ferdium/ferdium-app/releases/download/v7.1.1/Ferdium-linux-7.1.1-x86_64.rpm
      - fd
      - firefox
      - fzf
      - source-foundry-hack-fonts.noarch
      - git
      - git-delta
      - git-extras
      - htop
      - ipcalc
      - iperf3
      - jq
      - kitty
      - python3-neovim
      - python3-pygments
      - neovim
      - nextcloud-client
      - nextcloud-client-dolphin
      - nnn
      - nmap
      - openrgb
      - ripgrep
      - thefuck
      - thunderbird
      - tldr
      - tree
      - wl-clipboard
      - https://github.com/wezterm/wezterm/releases/download/20240203-110809-5046fc22/wezterm-20240203_110809_5046fc22-1.fedora39.x86_64.rpm
      - wireguard-tools
      - zsh

    - if:
      - cond: 'test -f /etc/private.true'
        met:
        - dnf:
          - darktable
          - rpi-imager
          - kubectl

- brew:
    - dnscontrol
    - eza
    - hugo
    - opentofu
    - minio-mc
    - jless
    - yq
    - gardener/tap/gardenctl-v2
    - thefuck


# TODO: Update einbauen
- shell:
    - description: Install stew
      command: |
        if ! command -v stew >/dev/null 2>&1; then
            ginstall github.com/marwanhawari/stew@latest
        fi

- shell:
    - description: "Install or Upgrade OpenStack CLI if not already installed"
      command: |
        if ! command -v openstack_cli-update >/dev/null; then
          curl --proto '=https' --tlsv1.2 -LsSf https://github.com/gtema/openstack/releases/latest/download/openstack_cli-installer.sh | sh
        else
          echo "OpenStack CLI already installed."
          echo "Upgrade ..."
          openstack_cli-update
        fi

    - description: "Install or Upgrade OpenStack TUI if not already installed"
      command: |
        if ! command -v openstack_tui-update >/dev/null; then
          curl --proto '=https' --tlsv1.2 -LsSf https://github.com/gtema/openstack/releases/latest/download/openstack_tui-installer.sh | sh
        else
          echo "OpenStack TUI already installed."
          echo "Upgrade ..."
          openstack_tui-update
        fi

#
# ToDo:
# - s3cfg and awscfg without secrets
# - ~/.gitconfig
# - Install fx: https://github.com/antonmedv/fx
# - iotop & iotop-c
# - Resticprofile
